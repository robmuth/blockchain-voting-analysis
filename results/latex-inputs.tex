% Number of method hashes (aka signatures)
\newcommand{\signatures}[0]{$1\,472$\@\xspace}
% Number of voting smart contracts (with methods > 1 and unique by their address)
\newcommand{\deployedVotingSmartContracts}[0]{$3\,512$\@\xspace}
% ... and the sum of their Ether balanaces
\newcommand{\deployedVotingSmartContractsBalanaces}[0]{$6\,243$\@\xspace}
\def\deployedVotingSmartContractsBalanacesDef{6243}


% Median Exchange Rate Usd/Eth of 2022
\def\exchange{1679}
\def\blockgaslimit{15000000}
\def\blockgaslimitmax{30000000}
\def\n{180}
\def\nmax{10000}
\def\medianBaseFeePerGas{35054752102}
\def\economicBlocks{188500}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Sum all received Ether to voting smart contracts
\newcommand{\deployedVotingSmartContractsReceivedEther}[0]{$12\,094\,377$\@\xspace}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\votingTransactions}[0]{$140\,396$\@\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\allTransactionsToVotingSmartContracts}[0]{$168\,758\,086$\@\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% SELECT
%  COUNT(*)
% FROM
%  diss-377408.diss.votingTransactions votingTransactions,
%  diss-377408.diss.functionSighashes functionSighashes,
%  diss-377408.diss.votingContractMethods votingContractMethods,
%  bigquery-public-data.crypto_ethereum.contracts contracts
% WHERE
%  functionSighashes.HASH = votingTransactions.function_sighash
%  AND DATE(votingTransactions.block_timestamp) <= "2022-12-31"
%  AND contracts.address = votingTransactions.to_address
%  AND contracts.address = votingContractMethods.address
%  AND votingContractMethods.voting_methods > 1
%  AND (signature like "%vote%" OR signature like "%Vote%") AND NOT (signature like "%votes%" OR signature like "%Votes%")

\newcommand{\voteMethodCalls}[0]{$115\,407$\@\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\votingSmartContractsWithMoreThanOneMethod}[0]{$3\,512$\@\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\votingSmartContractsWhichReceivedEther}[0]{$3\,454$\@\xspace}

% SELECT COUNT(*) FROM (
% SELECT
%  votingContract.address,
%  (SELECT SUM(value) / 1000000000000000000 FROM `bigquery-public-data`.crypto_ethereum.traces WHERE status = 1 AND to_address = votingContract.address and date(block_timestamp) <= "2022-12-31") - IFNULL((SELECT 0 + SUM(value) / 1000000000000000000 FROM `bigquery-public-data`.crypto_ethereum.traces WHERE status = 1 AND from_address = votingContract.address and date(block_timestamp) <= "2022-12-31"),0) unrounded,
%  ROUND((SELECT SUM(value) / 1000000000000000000 FROM `bigquery-public-data`.crypto_ethereum.traces WHERE status = 1 AND to_address = votingContract.address and date(block_timestamp) < "2022-12-31"), 1) as received_ether,
%  ROUND((SELECT SUM(value) / 1000000000000000000 FROM `bigquery-public-data`.crypto_ethereum.traces WHERE status = 1 AND to_address = votingContract.address and date(block_timestamp) <= "2022-12-31") - IFNULL((SELECT 0 + SUM(value) / 1000000000000000000 FROM `bigquery-public-data`.crypto_ethereum.traces WHERE status = 1 AND from_address = votingContract.address and date(block_timestamp) <= "2022-12-31"),0), 1) as balance_ether
% FROM
%  diss-377408.diss.votingContracts votingContract
%  , bigquery-public-data.crypto_ethereum.balances balances
%  , `diss-377408.diss.votingContractMethods` count
% WHERE
%  1=1
%  AND date(votingContract.block_timestamp) <= "2022-12-31"
%  AND votingContract.address = balances.address
%  AND count.address = votingContract.address
%  AND count.voting_methods > 1
%  group by votingContract.address
% HAVING unrounded > 0
% order by received_ether DESC
% )

\newcommand{\votingSmartContractsWhichStillHaveEther}[0]{$313$\@\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% select count(*) from (
% SELECT
%  votingTransactions.function_sighash sig_hash,
%  functionSighashes.signature signature,
%  votingTransactions.gas_price gas_price
% FROM
%  diss-377408.diss.votingTransactions votingTransactions,
%  diss-377408.diss.functionSighashes functionSighashes
% WHERE
%  functionSighashes.hash = votingTransactions.function_sighash
%  and date(votingTransactions.block_timestamp) <= "2022-12-31"
%  AND (signature like "%vote%" OR signature like "%Vote%") AND NOT (signature like "%votes%" OR signature like "%Votes%")
%  )

\newcommand{\votingMethodCalls}[0]{$137\,435$\@\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% CREATE TEMP FUNCTION MEDIAN(arr ANY TYPE) AS ((
%  SELECT
%    IF(
%      MOD(ARRAY_LENGTH(arr), 2) = 0,
%      (arr[OFFSET(DIV(ARRAY_LENGTH(arr), 2) - 1)] + arr[OFFSET(DIV(ARRAY_LENGTH(arr), 2))]) / 2,
%      arr[OFFSET(DIV(ARRAY_LENGTH(arr), 2))]
%    )
%  FROM (SELECT ARRAY_AGG(x ORDER BY x) AS arr FROM UNNEST(arr) AS x)
% ));

% SELECT
%  MEDIAN(array_agg(gas_price / 1000000000)) median,
%  STDDEV(gas_price / 1000000000) stddev
% FROM
%  diss-377408.diss.votingTransactions votingTransactions,
%  diss-377408.diss.functionSighashes functionSighashes
% WHERE
%  functionSighashes.hash = votingTransactions.function_sighash
%  and date(votingTransactions.block_timestamp) <= "2022-12-31"
%  AND (signature like "%vote%" OR signature like "%Vote%") AND NOT (signature like "%votes%" OR signature like "%Votes%")

\newcommand{\votingMethodsMedianGasPrice}[0]{$2.4$\@\xspace} % Gwei
\def\votingMethodsMedianGasPriceDef{2.4} % Gwei
\newcommand{\votingMethodsMedianGasPriceStdDev}[0]{$55.78$\@\xspace} % Gwei

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% CREATE TEMP FUNCTION MEDIAN(arr ANY TYPE) AS ((
%  SELECT
%    IF(
%      MOD(ARRAY_LENGTH(arr), 2) = 0,
%      (arr[OFFSET(DIV(ARRAY_LENGTH(arr), 2) - 1)] + arr[OFFSET(DIV(ARRAY_LENGTH(arr), 2))]) / 2,
%      arr[OFFSET(DIV(ARRAY_LENGTH(arr), 2))]
%    )
%  FROM (SELECT ARRAY_AGG(x ORDER BY x) AS arr FROM UNNEST(arr) AS x)
% ));

% SELECT
%  avg(votingTransactions.receipt_gas_used) avg,
%  median(array_agg(votingTransactions.receipt_gas_used)) median,
%  stddev(votingTransactions.receipt_gas_used) stddev
% FROM
%  `diss-377408.diss.votingTransactions` votingTransactions,
%  `diss-377408.diss.functionSighashes` functionSighashes,
%  `diss-377408.diss.votingContractMethods` votingContractMethods,
%  bigquery-public-data.crypto_ethereum.contracts contracts
% WHERE
%  functionSighashes.HASH = votingTransactions.function_sighash
%  AND DATE(votingTransactions.block_timestamp) <= "2022-12-31"
%  AND contracts.address = votingTransactions.to_address
%  AND contracts.address = votingContractMethods.address
%  AND votingContractMethods.voting_methods > 1
%  AND (signature like "%vote%" OR signature like "%Vote%") AND NOT (signature like "%votes%" OR signature like "%Votes%")

 
\newcommand{\votingMethodsGasAvg}[0]{$84\,419$\@\xspace} % gas
\newcommand{\votingMethodsGasMedian}[0]{$69\,696$\@\xspace} % gas
\newcommand{\votingMethodsGasStddev}[0]{$73\,038$\@\xspace} % gas
 
\newcommand{\votingSmartContractsTotalDeposits}[0]{$24\,723\,598$\@\xspace}
\newcommand{\votingSmartContractsTotalWithdrawls}[0]{$24\,717\,291$\@\xspace}
\newcommand{\votingSmartContractsTotalBalance}[0]{$6\,307$\@\xspace}
\def\votingSmartContractsTotalBalanceDef{6307}
\newcommand{\votingSmartContractsTotalBalancePercent}[0]{$0.03$\@\xspace}
 
\newcommand{\theDAOContractsDeployments}[0]{$88$\@\xspace}
\newcommand{\theDAOContractsVotingTransactions}[0]{$5\,929$\@\xspace}
\newcommand{\theDAOContractsVotingTransactionsGasMedian}[0]{$150\,000$\@\xspace}
\newcommand{\theDAOContractsVotingTransactionsGaspriceMedian}[0]{$21\,000\,000\,000$\@\xspace}
 
\newcommand{\dashFirstProposal}[0]{\mbox{2015-08-27}\@\xspace}
\newcommand{\dashLastProposal}[0]{\mbox{2022-12-31}\@\xspace}
\newcommand{\dashProposals}[0]{\mbox{702}\@\xspace}
\newcommand{\dashProposalsWillBeFunded}[0]{\mbox{532}\@\xspace}
 

\newcommand{\dashFunded}[0]{$181\,767$\@\xspace}
\newcommand{\dashFundedUsd}[0]{$20.90$\@\xspace}


% Avg P2PKH transaction weight and stddev 2022-12-31
\newcommand{\bitcoinPToPKHWeight}[0]{$110$\@\xspace}
\newcommand{\bitcoinPToPKHWeightStd}[0]{$0.070$\@\xspace}
 
